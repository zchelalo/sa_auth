# Saloncito Authentication Submodule
This submodule manages project authentication.

### Table of contents
- [How to run the project?](#how-to-run-the-project)
  - [Prerequisites](#prerequisites)
  - [Project cloning](#project-cloning)
  - [Environment variables](#environment-variables)
  - [Asymmetric key creation](#asymmetric-key-creation)
  - [Docker execution](#docker-execution)
  - [Migrations](#migrations)
  - [Proto files](#proto-files)
- [Testing](#testing)
- [Documentation](#documentation)
  - [Typedoc](#typedoc)

## How to run the project?
### Prerequisites
- [Docker](https://docs.docker.com/install/)
- [Docker compose](https://docs.docker.com/compose/install/)
- [NodeJS](https://nodejs.org/en/download/package-manager)
- [Protoc](https://grpc.io/docs/protoc-installation/)

*Note: Keep in mind that the entire project was tested on WSL.*

### Project cloning
If you haven't cloned the project yet, you can do so by running `git clone <url>`. Once the project is cloned, if you plan to write code or generate code using protoc, make sure to run `npm install` to install the necessary packages locally. This will set up autocomplete and ensure you have all the required dependencies for code generation.

### Environment variables
To configure the environment variables within the project, there is a script in the package.json file called `npm run create:envs`. When executed, it will copy the ".env.example" file to a ".env" file. If you need to change something, just modify the newly created ".env" file.

### Asymmetric key creation
The certificates used for authentication management are also important for future features like password changes. They are created by running the script `npm run create:certs` in the package.json file. This will generate the .pem files needed for the application to work properly.

### Docker execution
After configuring the environment variables, it's time to run the Docker containers. The necessary files are located in the ".dockers" folder. Run the package.json script `npm run compose`, which will execute the ".dockers/docker-compose.yml" file and start building the project. If necessary, there is also a command `npm run compose:build` that explicitly builds the project.

### Migrations
Before anything else, for the migrations to work, the "docker compose" must be running since the database needs to be active.

Migrations are done with Drizzle. First, the ".sql" files and migration metadata are generated by running `npm run migration:generate`. These SQL schemas are based on the models created with Drizzle, including the tables, their structure, relationships, indexes—everything is done automatically.

Once the migrations are generated, you need to push them with `npm run migration:push`. This will apply the previously generated migrations.

Sometimes it can be tedious to run these two commands separately, so there's a command that creates the migrations and then pushes them in one go: `npm run migrate`.

Once the migrations have been executed, the only step left is to run the seed. This will insert some necessary records for the application to function, such as the authentication token keys.

### Proto files
If you modified any proto file in the "sa_proto" submodule and need to generate the TS files, you can run `npm run proto:generate`, and the TS files will be generated.

## Testing
Once the entire project is running, it’s time to execute the tests. These are located in the "test" folder, and within it, the path of the tested file is replicated, with the only difference being that it includes ".test" after the name. The script to run the tests can be found in the package.json file, which in this case is `npm run test`. First, it sets the "NODE_ENV" environment variable to "test", so when loading the environment variables in the project, the ".env.test" file is loaded. If you want to handle a different value in the environment variables during the tests, you can do so.

Running the tests will create a "coverage" folder at the root of the project. Inside, there are two reports regarding the tests. The first is a test report called "test-report.html", which contains information on whether the tests passed or failed. The second file created is called "index.html", which contains all the information about how many lines of code are covered by tests. You can navigate through the code to see which lines need more testing, allowing you to write more comprehensive tests.

## Documentation
Documentation is essential to make a project maintainable and scalable. In this project, two tools were used for this purpose.

### Typedoc
It was used to document the code, explain the purpose of functions, variables, enums, classes, interfaces, etc. To view the project's documentation, run a script from the package.json file called `npm run create:docs`. This will create a folder at the root of the project called "docs", where you can find "index.html", the file you need to open to view all the generated documentation.